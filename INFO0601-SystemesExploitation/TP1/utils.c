
#include "utils.h"

/**
 * ncurses initialisation.
 */
void ncurses_init() {
  initscr();	        // Start ncurses mode
  cbreak();	            // Disable the buffer cache
  noecho();             // Disable the display of typed characters
  keypad(stdscr, TRUE);	// Activate specific keys (arrows)
  refresh();            // Update display
  curs_set(FALSE);      // Hide the cursor
}

/**
 * Stop ncurses.
 */
void ncurses_stop() {
  endwin();
}

/**
 * Colors initialisation.
 */
void ncurses_colors() {
  // Check color support
  if (has_colors() == FALSE) {
    ncurses_stop();
    fprintf(stderr, "The terminal doesn't support colors.\n");
    exit(EXIT_FAILURE);
  }

  // Activate colors
  start_color();
}

/**
 * Palette definition.
 */
void palette() {
    init_pair(WHITE, COLOR_WHITE, COLOR_BLACK);
    init_pair(GREEN, COLOR_GREEN, COLOR_BLACK);
    init_pair(BLUE, COLOR_BLUE, COLOR_BLACK);
    init_pair(RED, COLOR_RED, COLOR_BLACK);
    init_pair(YELLOW, COLOR_YELLOW, COLOR_BLACK);
    init_pair(CYAN, COLOR_CYAN, COLOR_BLACK);
    init_pair(MAGENTA, COLOR_MAGENTA, COLOR_BLACK);
    init_pair(FD_WHITE, COLOR_BLACK, COLOR_WHITE);
    init_pair(FD_GREEN, COLOR_BLACK, COLOR_GREEN);
    init_pair(FD_BLUE, COLOR_BLACK, COLOR_BLUE);
    init_pair(FD_RED, COLOR_BLACK, COLOR_RED);
    init_pair(FD_YELLOW, COLOR_BLACK, COLOR_YELLOW);
    init_pair(FD_CYAN, COLOR_BLACK, COLOR_CYAN);
    init_pair(FD_MAGENTA, COLOR_BLACK, COLOR_MAGENTA);
}

/**
 * Mouse initialisation.
 */
void ncurses_init_mouse() {
  if (!mousemask(BUTTON1_PRESSED, NULL)) {
    ncurses_stop();
    fprintf(stderr, "Mouse isn't supported.\n");
    exit(EXIT_FAILURE);
  }
}

/**
 * Get the mouse position.
 */
int mouse_getpos(int *x, int *y) {
  MEVENT event;
  int result = getmouse(&event);
  if (result == OK) {
    *x = event.x;
    *y = event.y;
  }
  return result;
}
