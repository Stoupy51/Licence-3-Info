
#include "share.h"

#include <sys/types.h>

/**
 * Initialise une variable partagée
 * @param tab_size la taille du tableau à partager
 * @return la variable partagée initialisée
*/
shared_var_t initSharedVar(int tab_size) {
	shared_var_t var;
	var.req.tab_size = tab_size;
	size_t size = tab_size * sizeof(int);
	var.req.tab = malloc(size);
	if (var.req.tab == NULL) {
		perror("Erreur lors de l'allocation mémoire dans initSharedVar");
		exit(EXIT_FAILURE);
	}
	memset(var.req.tab, 0, size);
	var.rep.res = 0;
	var.addr = NULL;
	return var;
}

/**
 * Libère une variable partagée
 * @param var la variable partagée à libérer
*/
void freeSharedVar(shared_var_t* var) {
	free(var->req.tab);
	free(var);
}

/**
 * Récupère la taille du tableau partagé
 * @param var la variable partagée
 * @return la taille du tableau partagé
*/
int getSharedVarSize(shared_var_t var) {
	return var.req.tab_size;
}

/**
 * Modifie la taille du tableau partagé
 * @param var la variable partagée
*/
void setSharedVarSize(shared_var_t* var, int tab_size) {
	size_t size = tab_size * sizeof(int);
	int *t = malloc(size);
	if (t == NULL) {
		perror("Erreur lors de l'allocation mémoire dans setSharedVarSize");
		exit(EXIT_FAILURE);
	}
	memset(t, 0, size);

	int_fast32_t i;
	for (i = 0; i < var->req.tab_size && i < tab_size; i++) {
		t[i] = var->req.tab[i];
	}

	free(var->req.tab);
	var->req.tab = t;
}



