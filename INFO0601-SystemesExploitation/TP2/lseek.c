
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <fcntl.h>

int main(int argc, char *argv[]) {
	if (argc != 2) {
		fprintf(stderr, "Usage: %s <fichier>\n", argv[0]);
		exit(EXIT_FAILURE);
	}
	char* file = argv[1];

	// Déterminer la taille du fichier

	int fd;
	if ((fd = open("toto.bin", O_RDONLY)) == -1) {
		perror("Erreur lors de l'ouverture du fichier");
		exit(EXIT_FAILURE);
	}
	fprintf(stdout, "Taille du fichier : %d octets\n", lseek(fd, 0, SEEK_END));

	if (close(fd) == -1) {
		perror("Erreur lors de la fermeture du fichier\n");
		exit(EXIT_FAILURE);
	}




	if ((fd = open("intFile.bin", O_WRONLY | O_CREAT, S_IRUSR | S_IWUSR)) == -1) {
		perror("Erreur lors de l'ouverture du fichier\n");
		exit(EXIT_FAILURE);
	}

	int i, ints[10];
	for (i = 0; i < 10; i++) {
		ints[i] = i + 1;
	}

	if (write(fd, &ints, sizeof(ints)) == -1) {
		perror("Erreur lors de l'écriture dans le fichier\n");
		exit(EXIT_FAILURE);
	}
	fprintf(stdout, "Ecriture des entiers de 1 à 10 dans le fichier intFile.bin\n");

	fprintf(stdout, "Position actuelle : %d\n", lseek(fd, 0, SEEK_CUR));

	if (lseek(fd, 1000000, SEEK_SET) == -1) {
		perror("Erreur lors du déplacement du curseur\n");
		exit(EXIT_FAILURE);
	}
	fprintf(stdout, "Position actuelle : %d\n", lseek(fd, 0, SEEK_CUR));
	
	char c = 'A';
	if (write(fd, &c, sizeof(char)) == -1) {
		perror("Erreur lors de l'écriture dans le fichier\n");
		exit(EXIT_FAILURE);
	}
	fprintf(stdout, "Ecriture de %c dans le fichier intFile.bin\n", c);

	if (close(fd) == -1) {
		perror("Erreur lors de la fermeture du fichier\n");
		exit(EXIT_FAILURE);
	}
	fprintf(stdout, "\n");
	return 0;
}

