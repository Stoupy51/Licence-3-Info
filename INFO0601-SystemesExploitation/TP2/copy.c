
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <fcntl.h>

int main(int argc, char *argv[]) {
	if (argc != 3) {
		fprintf(stderr, "Usage: %s <source> <destination>\n", argv[0]);
		exit(EXIT_FAILURE);
	}
	char* source = argv[1];
	char* destination = argv[2];

	int fd;
	if ((fd = open(source, O_RDONLY)) == -1) {
		perror("Erreur lors de l'ouverture du fichier");
		exit(EXIT_FAILURE);
	}

	int fd2;
	if ((fd2 = open(destination, O_WRONLY | O_CREAT, S_IRUSR | S_IWUSR)) == -1) {
		perror("Erreur lors de l'ouverture du fichier");
		exit(EXIT_FAILURE);
	}

	// Copie du fichier (à faire : sans copier l'intégralité de la mémoire)
	char buffer[1048576]; // 1 Mo
	int n;
	while ((n = read(fd, buffer, sizeof(buffer))) > 0) {
		if (write(fd2, buffer, n) == -1) {
			perror("Erreur lors de l'écriture dans le fichier");
			exit(EXIT_FAILURE);
		}
	}


	if (close(fd) == -1) {
		perror("Erreur lors de la fermeture du fichier");
		exit(EXIT_FAILURE);
	}

	if (close(fd2) == -1) {
		perror("Erreur lors de la fermeture du fichier");
		exit(EXIT_FAILURE);
	}

	return EXIT_SUCCESS;
}
