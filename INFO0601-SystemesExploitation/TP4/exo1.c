
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <fcntl.h>
#include <sys/wait.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <time.h>

#define Stou_0 "\033[0m"	// RESET
#define Stou_R "\033[0;31m" // RED
#define Stou_Y "\033[0;33m"	// YELLOW

int main(int argc, char *argv[]) {
	printf("\n");

	if (argc != 2) {
		printf("Usage: %s <nombre_de_fils>\n", argv[0]);
		return EXIT_FAILURE;
	}

	int nb_fils = atoi(argv[1]);
	pid_t parent = getpid();

	int i;
	for (i = 0; i < nb_fils; i++) {
		if (fork() == 0) {
			srand(getpid() + time(NULL));
			sleep(rand() % 5);
			printf(Stou_Y"[Fork #%d] N aléatoire : %d. Je suis PID=%d, PPID=%d)\n"Stou_0, i + 1, rand(), getpid(), parent);
			exit(EXIT_SUCCESS);
		}
	}

	for (i = 0; i < nb_fils; i++) {
		pid_t pid = wait(NULL);
		if (pid == -1) {
			perror("Erreur lors de l'attente du fils");
			exit(EXIT_FAILURE);
		}
		printf(Stou_R"Mon fils %d a terminé !\n"Stou_0, pid);
	}
	
	return EXIT_SUCCESS;
}

