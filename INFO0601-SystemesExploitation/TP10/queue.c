
#include "include.h"
#include "queue.h"

#include <stdio.h>
#include <stdlib.h>
#include <string.h>

queue_t initQueue(int size) {
	queue_t q;
	q.size = size + 1;
	q.head = q.tail = 0;
	q.data = malloc(sizeof(char*) * q.size);
	if (q.data == NULL) {
		perror("Erreur : Impossible d'allouer la mémoire pour la queue\n");
		exit(EXIT_FAILURE);
	}
	int i;
	for (i = 0; i < q.size; i++) {
		q.data[i] = malloc(sizeof(char) * MESSAGE_SIZE);
		if (q.data[i] == NULL) {
			perror("Erreur : Impossible d'allouer la mémoire pour la queue\n");
			exit(EXIT_FAILURE);
		}
	}
	return q;
}

void destroyQueue(queue_t q) {
	free(q.data);
	q.size = 0;
}

int isQueueEmpty(queue_t q) {
	return q.head == q.tail;
}

int isQueueFull(queue_t q) {
	return (!q.tail && q.head == q.size - 1) || (q.head + 1) % q.size == q.tail;
}

int enfilerQueue(queue_t* q, char* str) {
	if (isQueueFull(*q)) {
		fprintf(stderr,"Erreur : La queue est pleine\n");
		return -1;
	}
	strcpy(q->data[q->head], str);
	q->head = (q->head + 1) % q->size;
	return 0;
}

char* defilerQueue(queue_t* q, char verbose) {
	if (isQueueEmpty(*q)) {
		if (verbose)
			fprintf(stderr,"Erreur : La queue est vide\n");
		return "";
	}
	char* str = q->data[q->tail];
	q->data[q->tail] = NULL;
	q->tail = (q->tail + 1) % q->size;
	return str;
}

void printQueue(queue_t q) {
	fprintf(stderr,"\nQueue : ");
	if (isQueueEmpty(q)) {
		fprintf(stderr,"Vide");
		return;
	}
	fprintf(stderr,"[");
	fprintf(stderr,"%s", q.data[0]);
	int i = 1;
	for (; i < q.size; i++)
		fprintf(stderr,", %s", q.data[i]);
	fprintf(stderr,"]\n");
}



