
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <fcntl.h>
#include <sys/wait.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <time.h>
#include <signal.h>

#define Stou_0 "\033[0m"	// RESET
#define Stou_R "\033[0;31m" // RED
#define Stou_G "\033[0;32m" // GREEN
#define Stou_Y "\033[0;33m" // YELLOW

/**
 * Handler for the signal.
 * @param signum the received signal number
 */
void handler(int signum) {
	if (signum == SIGINT) {
		printf(Stou_G "Signal SIGINT reçu !\n" Stou_0, signum);
	}
	else {
		printf(Stou_R "Signal " Stou_Y "%d" Stou_R " reçu !\n" Stou_0, signum);
	}
}

int main(int argc, char *argv[]) {
	printf("\n");

	printf(Stou_G "Server started : " Stou_Y "%d" Stou_G ".\n" Stou_0, getpid());

	// Attente du signal SIGINT
	struct sigaction action;
	sigemptyset(&action.sa_mask);
	action.sa_flags = 0;
	action.sa_handler = handler;
	if (sigaction(SIGINT, &action, NULL) == -1) {
		perror("Error positioning the handler\n");
		exit(EXIT_FAILURE);
	}

	sigset_t set;

	// Attente de n'importe quel autre signal que SIGUSR1
	sigemptyset(&set);
	sigaddset(&set, SIGUSR1);
	if(sigprocmask(SIG_BLOCK, &set, NULL) == -1) {
        perror("Erreur lors du blocage des signaux\n");
        exit(EXIT_FAILURE);
    }
	sigsuspend(&set);

	printf("\n");
	return EXIT_SUCCESS;
}
